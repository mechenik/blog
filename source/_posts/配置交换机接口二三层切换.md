---
title: 配置华为交换机接口二三层切换
author: mechenik
top: false
cover: 'https://inews.gtimg.com/newsapp_ls/0/14909261238/0.jiketuchuang.png'
mathjax: false
summary: 基于接口板的硬件构造，某些形态设备上接口只能作为二层以太网接口，某些形态设备上接口只能作为三层以太网接口。
categories: 运维手册
tags:
  - 交换机
  - 华为
abbrlink:
date: 2022-04-22 09:25:00
img:
coverImg:
password:
---

基于接口板的硬件构造，某些形态设备上接口只能作为二层以太网接口，某些形态设备上接口只能作为三层以太网接口，而还有一些接口则比较灵活，可以改变其二三层模式：在二层模式下，该接口作为一个二层以太网接口使用；在三层模式下，该接口作为一个三层以太网接口使用。

## 配置注意事项

1.缺省情况下，设备的以太网接口工作在二层模式，并且已经加入VLAN1。将接口转换为三层模式后，该接口并不会立即退出VLAN1，只有当三层协议UP后，接口才会退出VLAN1。

2.以太网接口的二三层模式既可以在以太网接口视图下配置也可以在系统视图下配置。当两种视图下配置的二三层模式不同时，最新配置生效。

3.连续执行portswitch、undo portswitch命令切换接口二三层工作模式的最小时间间隔是30秒。即切换接口工作在一种二三层模式后，用户需要等待至少30秒才能切换接口工作在另外一种二三层模式。

4.如果接口上有业务配置存在（例如port link-type trunk配置），需要先将该接口下的业务配置全部清除才能执行命令切换接口的二三层模式。

5.如果接口上已经有业务配置存在（例如port link-type trunk配置），需要先将该接口下的业务配置全部清除才能执行命令切换接口的二三层模式。接口上只存在属性配置信息（例如shutdown、description配置），这些属性配置则无需清除，可以直接切换接口的二三层模式。
组网需求


## 组网需求

![image.png](https://inews.gtimg.com/newsapp_ls/0/14909261238/0.jiketuchuang.png)

如图1所示，PC1、PC2、PC3和PC4分别属于不同网段，SwitchB、SwitchC、SwitchD、SwitchE分别为这四个网段的接入层交换机。用户希望使用SwitchA上的四个以太网物理接口作为这四个网段的网关接口。


## 配置思路

### 配置接口切换到三层模式

#### 配置单个接口切换到三层模式。


	<HUAWEI> system-view
	[HUAWEI] sysname SwitchA
	[SwitchA] interface gigabitethernet 1/0/1
	[SwitchA-GigabitEthernet1/0/1] undo portswitch
	[SwitchA-GigabitEthernet1/0/1] quit

	
#### 配置以太网接口批量切换到三层模式。

	[SwitchA] undo portswitch batch gigabitethernet 1/0/2 to 1/0/4
	
#### 配置三层接口的IP地址作为网关

	[SwitchA] interface gigabitethernet 1/0/1
	[SwitchA-GigabitEthernet1/0/1] ip address 10.10.1.1 24
	[SwitchA-GigabitEthernet1/0/1] quit

	
## 验证配置结果

	[SwitchA] display interface gigabitethernet 1/0/1　　//检查接口当前工作模式
	...
	Description:
	Route Port,The Maximum Frame Length is 9216
	Internet Address is 10.10.1.1/24
	...
	
	
如果回显字段为Switch Port，代表接口工作在二层模式；如果回显字段为Route Port，代表接口工作在三层模式。由上述回显字段可以看出接口工作在三层模式。